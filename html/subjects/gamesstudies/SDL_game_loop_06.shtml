<!DOCTYPE html>
<!--#include virtual="/includes/head.shtml" -->
<body onload="onloadProc()">
<!--#include virtual="/includes/inprogress.shtml" -->
<!--#include virtual="/includes/animation.shtml" -->
<div id="pagewrap">
<!--#include virtual="/includes/sitename.shtml" -->
<div id="topstripe"></div>
<!--#include virtual="/includes/sidemenu.shtml" -->
<div id="content">
<!--#include virtual="/includes/topblurb.shtml" -->
<h1>Screen updating</h1>
<p>You can use these code snippets as a basis for further experimentation. The key event response calculates new coordinates for the player, enforcing any boundaries. It then calls the draw routine</p>
<p>The draw routine prepares two rectangles; one is for the new location of the player, the other is a cover rectangle for where the player <i>was</i>. Only the portion of the background corresponding to the old location is re-drawn.</p>
<p>Note that key-repeat values can give the impression of slowness in your game loop.</p>
<pre>
  ...SNIP..
    $cover = $background;
  ...SNIP..

  ...SNIP..
  
  elsif ($key_name eq "right") {
    # Store the old coordinate - we'll need it later
    $old_x = $player_x;
    # try to move
    $player_x +=$granularity;
    # test for limits of screen, play area
    if ($player_x &gt; $player_x_max) {
      $player_x = $player_x_max; # reset coords if move is too far
    }
    # call the draw routine
    &amp;draw_player($player_x, $player_y, $old_x, $player_y);
  }
  
  ...SNIP..
  
  ...SNIP..
  
  sub draw_player {
    my ($new_rect, $cover_rect);
    # get parameters into my local variables
    my ($x, $y, $oldx, $oldy) = @_;
    # define a new rectangle for the player's new location
    $new_rect = SDL::Rect-&gt;new($x, $y, $image-&gt;w, $image-&gt;h);
    # define a rectangle for where the player was
    $cover_rect = SDL::Rect-&gt;new($old_x, $old_y, $image-&gt;w, $image-&gt;h);
    # copy only a portion of the background to where the player was - covering the old location
    SDL::Video::blit_surface(<b><big>$cover</big></b>, $cover_rect, $application, $cover_rect );    
    # Now draw the player in the new location
    SDL::Video::blit_surface ($image, $new_rect, $application, $new_rect);
    # Update those rectangles only 
    SDL::Video::update_rects($application,  $cover_rect, $new_rect);
  }
  
  ...SNIP..
</pre>
<small><!--#config timefmt="%Y%m%d-%H:%M" -->Last updated: <!--#flastmod file="SDL_game_loop_04.shtml" --></small>
</div> <!-- #content -->
<!--#include virtual="/includes/backtotop.shtml" -->
</div> <!-- #pagewrap -->
</body>
</html>
