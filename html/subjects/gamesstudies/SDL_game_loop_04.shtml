<!DOCTYPE html>
<!--#include virtual="/includes/head.shtml" -->
<body onload="onloadProc()">
<!--#include virtual="/includes/inprogress.shtml" -->
<!--#include virtual="/includes/animation.shtml" -->
<div id="pagewrap">
<!--#include virtual="/includes/sitename.shtml" -->
<div id="topstripe"></div>
<!--#include virtual="/includes/sidemenu.shtml" -->
<div id="content">
<!--#include virtual="/includes/topblurb.shtml" -->
<h1>Basic game/event loop</h1>
<p>You can use this as a basis for further programs which require a game loop which handles input events; this also re-draws a foreground item at a new location in response to mouse clicks.</p>
<pre>#!/usr/bin/perl
use strict;
# Purpose: demonstrate basics of displaying an image on a background, and then 
#       re-drawing at a new location;
#       This is a graphics program using SDL. Program creates an App., creates a
#       rectangle, draws background in rectangle, draws an image on the background
#       starts a game loop which re-draws the foreground image at the mouse (x,y)
#       Also reports mouse and keyboard events. 'x' or 'Q' to quit.
# Date:   2013
# Author: Fachtna Roe

use SDL; #needed to get all constants
use SDL::Video;
use SDLx::App;
use SDL::Surface;
use SDL::Rect;
use SDL::Image;
use SDL::Event;
use SDL::Mouse;

my ($screen, $back, $back_rect, $event, $exiting, $front, $front_rect, $item_x, $item_y, $dest_rect, $front_h, $front_w);
# First create a new App
$screen = SDLx::App-&gt;new(
    title  =&gt; "Put a Window title here",
    width  =&gt; 800, # use same width as background image
    height =&gt; 600, # use same height as background image
    depth  =&gt; 32,
    exit_on_quit =&gt; 1 # Enable 'X' button
);
# Add event handler for quit (covered also by 'q' of 'x' from keyboard)
$screen-&gt;add_event_handler( \&amp;quit_event );
# Load an image for the background
# If the program is run without an available image the error
#  "Can't call method "w" on an undefined value at ThisFile.pl line XX."
# will be received.

#put an image file name here
$back = SDL::Image::load('put an image file name here');
# Create a rectangle for the background image
$back_rect = SDL::Rect-&gt;new(0,0,
    $back-&gt;w,
    $back-&gt;h,
);
# Create a new event structure variable
$event = SDL::Event-&gt;new();
# Draw the background
SDL::Video::blit_surface($back, $back_rect, $screen, $back_rect );

# Now load image data for a foreground item
$front = SDL::Image::load('put an image file name here');
# Put the image at the location X, Y which is top left
# Initially this will be 0,0
$item_x = 0;
$item_y = 0;
$front_w = $front-&gt;w;
$front_h = $front-&gt;h;
$front_rect = SDL::Rect-&gt;new($item_x,$item_y,$front_w,$front_h,);
    
# Draw the image
SDL::Video::blit_surface ($front, $front_rect, $screen, $front_rect);
# Update the window
SDL::Video::update_rects($screen);
$exiting = 0;
# Start a game loop
while ( !$exiting ) {
  $screen-&gt;update;
  # Update the queue to recent events
  SDL::Events::pump_events();
  # process all available events
  while (SDL::Events::poll_event($event)) {
    # check by Event type      
    if ($event-&gt;type == SDL_QUIT) {
      &amp;quit_event(); 
    }
    elsif ($event-&gt;type == SDL_KEYUP) {
        &amp;key_event($event);
    }
    elsif ($event-&gt;type == SDL_MOUSEBUTTONDOWN) {
      &amp;mouse_event($event);
      $dest_rect = SDL::Rect-&gt;new(
        $item_x,
        $item_y,
        $front_w,
        $front_h);      
      # re-draw the background 
      SDL::Video::blit_surface($back, $back_rect, $screen, $back_rect );
      # Now draw the object in the new location
      SDL::Video::blit_surface($front, $front_rect, $screen, $dest_rect );
    }
  }
  SDL::Video::update_rects($screen);
  # slow things down if required
  $screen-&gt;delay(100);
} # game loop

sub quit_event {
	exit;
}

sub key_event {
  # printed output from here is going to the CLI
  print "Key is: ";
  my $key_name = SDL::Events::get_key_name( $event-&gt;key_sym );  
  print "[$key_name]\n";
  if (($key_name eq "q") || ($key_name eq "Q") ) {
    $exiting = 1;
  }
  if (($key_name eq "x") || ($key_name eq "X") ) {
    $exiting = 1;
  }
}

sub mouse_event {
  # printed output from here is going to the CLI
  print "Mouse: ";
  my ($mouse_mask,$mouse_x,$mouse_y)  = @{SDL::Events::get_mouse_state()};
  print "[$mouse_x, $mouse_y]\n";
  # We're not just printing the mouse (x,y), we're going to use it later
  $item_x = $mouse_x; 
  $item_y = $mouse_y;
}
</pre>
<small><!--#config timefmt="%Y%m%d-%H:%M" -->Last updated: <!--#flastmod file="SDL_game_loop_04.shtml" --></small>
</div> <!-- #content -->
<!--#include virtual="/includes/backtotop.shtml" -->
</div> <!-- #pagewrap -->
</body>
</html>
