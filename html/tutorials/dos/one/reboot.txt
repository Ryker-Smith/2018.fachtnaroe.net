Want to know how to make Windows shut down from a batch 
file? I didn't used to know, but thanks to a tip from 
Nick Cross ( NickC@agsolutions.co.uk ) I know now! 
Nick suggested using RUNDLL to call the Windows API 
shutdown routines. I decided to look through my API 
references to see how ExitWindows was supposed to be 
called. Near as I could tell, this line:

rundll user,exitwindows 0 5

would cause an immediate shutdown. And whatdoyouknow, 
it does! For those of you who are more stealthy, 
you don't have to advertise the function name:

rundll user,#7 0 5

If you have problems, you can try dropping or trying 
different arguments. Both of the following have been
known to work:

rundll user,exitwindows
rundll user,exitwindows 66 0

To do a restart, try one of these:

rundll user,exitwindowsexec
rundll user,#246

And then there are variations like using rundll32 instead
of rundll:

rundll32 user.exe,#7

One of the main hangups is in actually trying to shut 
Windows down from a batch file. The problem is that the
DOS session is still running when Windows tries to shut
down. So you'll often get a box telling you to you have
to shut the program (the DOS box) down. The whole purpose
of the "arguments" I show for "exitwindows" is to force 
the shutdown. I've had a lot more success by using a
scheduling program to execute the rundll program.

Another problem I ran into was screensavers. Some 
screensavers are considered programs and will stop a 
scheduled reboot. The one that bit me was a screensaver 
from the movie Matrix. All day long I tested my reboot 
just fine, but my scheduled 3am reboot always failed until 
I changed the screensaver.


http://www.calweb.com/~webspace
